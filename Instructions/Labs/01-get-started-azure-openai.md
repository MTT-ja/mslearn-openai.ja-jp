---
lab:
    title: 'Azure OpenAI の使い始め'
---

# Azure OpenAI Service の使い始め

Azure OpenAI Service は、OpenAI によって開発された生成AIモデルを Azure プラットフォームにもたらし、セキュリティ、スケーラビリティ、および Azure クラウドプラットフォームによって提供されるサービスの統合から恩恵を受ける強力な AI ソリューションを開発することを可能にします。この演習では、Azure OpenAI サービスを Azure リソースとしてプロビジョニングし、Azure OpenAI Studio を使用して OpenAI モデルをデプロイおよび探索する方法を学びます。

この演習には約 **30** 分かかります。

## Azure OpenAI リソースのプロビジョニング

まだお持ちでない場合は、Azure サブスクリプションに Azure OpenAI リソースをプロビジョニングしてください。

1. `https://portal.azure.com` で **Azure portal** にサインインします。
2. 次の設定で **Azure OpenAI** リソースを作成します：
    - **サブスクリプション**: *Azure OpenAI サービスへのアクセスが承認されている Azure サブスクリプションを選択*
    - **リソースグループ**: *リソースグループを選択または作成*
    - **リージョン**: *利用可能なリージョンから **ランダム** に選択*\*
    - **名前**: *お好きなユニークな名前*
    - **価格レベル**: Standard S0

    > \* Azure OpenAI リソースはリージョナルなクオータによって制限されています。ランダムにリージョンを選択することで、他のユーザーとサブスクリプションを共有するシナリオで単一のリージョンがクオータ制限に達するリスクを減らすことができます。演習の後半でクオータ制限に達した場合、別のリージョンで別のリソースを作成する必要があるかもしれません。

3. デプロイが完了するのを待ちます。その後、Azure portal でデプロイされた Azure OpenAI リソースに移動します。

## モデルのデプロイ

Azure OpenAI は、**Azure OpenAI Studio** という Web ベースのポータルを提供しており、これを使用してモデルのデプロイ、管理、および探索を行うことができます。Azure OpenAI Studio を使用してモデルをデプロイすることで、Azure OpenAI の探索を開始します。

1. Azure OpenAI リソースの **概要** ページで、**Azure OpenAI Studio に移動** ボタンを使用して、新しいブラウザタブで Azure OpenAI Studio を開きます。
2. Azure OpenAI Studio の **デプロイ** ページで、既存のモデルデプロイを表示します。まだお持ちでない場合は、次の設定で **gpt-35-turbo-16k** モデルの新しいデプロイを作成します：
    - **モデル**: gpt-35-turbo-16k *(16k モデルが利用できない場合は、gpt-35-turbo を選択)*
    - **モデルバージョン**: デフォルトに自動更新
    - **デプロイ名**: *お好きなユニークな名前*
    - **詳細オプション**
        - **コンテンツフィルター**: デフォルト
        - **分あたりのトークン数の制限**: 5K\*
        - **動的クオータの有効化**: 有効

    > \* 分あたり5,000トークンの制限は、この演習を完了するのに十分であり、同じサブスクリプションを使用する他の人々のための容量も残しておくことができます。

## チャットプレイグラウンドを使用する

*チャット* プレイグラウンドは、GPT 3.5 およびそれ以上のモデルに対してチャットボットインターフェースを提供します。

> **注:** *チャット* プレイグラウンドは、*Completions* プレイグラウンドで使用される古い *Completions* APIではなく、*ChatCompletions* APIを使用します。*Completions* プレイグラウンドは、古いモデルとの互換性のために提供されています。

1. **プレイグラウンド** セクションで、**チャット** ページを選択します。**チャット** プレイグラウンドページには3つの主要なセクションがあります：
    - **アシスタント設定** - モデルの応答の文脈を設定するために使用されます。
    - **チャットセッション** - チャットメッセージを送信し、応答を表示するために使用されます。
    - **構成** - モデルデプロイの設定を構成するために使用されます。
1. **構成** セクションで、モデルデプロイが選択されていることを確認します。
1. **アシスタント設定** セクションの **システムメッセージ** ボックスで、現在のテキストを次の文に置き換えます：`システムは、人々がAIについて学ぶのを助けるAI教師です`。

3. **システムメッセージ** ボックスの下で、**例を追加** を選択し、指定されたボックスに次のメッセージと応答を入力します：

    - **ユーザー**: `人工知能の異なるタイプは何ですか？`
    - **アシスタント**: `人工知能には3つの主要なタイプがあります：狭いまたは弱いAI（SiriやAlexaのような仮想アシスタント、画像認識ソフトウェア、スパムフィルターなど）、一般的または強いAI（人間と同じくらい賢いように設計されたAI。このタイプのAIは現在存在せず、純粋に理論的です）、そして人工超知能（人間を超える知能を持ち、人間の理解を超えるタスクを実行できるAI。このタイプのAIも純粋に理論的であり、まだ開発されていません）。`

    > **注**: Few-shotの例は、期待される応答のタイプの例をモデルに提供するために使用されます。モデルは、その応答で例のトーンとスタイルを反映しようとします。

4. 変更を保存して新しいセッションを開始し、チャットシステムの行動文脈を設定します。
5. **チャットセッション** セクションで、ユーザークエリ `人工知能とは何ですか？` を入力します。

    > **注**: APIデプロイがまだ準備ができていないという応答を受け取る場合があります。その場合は、数分待ってからもう一度試してください。

6. 応答を確認し、次のメッセージを送信して会話を続けます：`それは機械学習とどのように関連していますか？`
7. 前のインタラクションからの文脈が保持されていることに注意しながら、応答を確認します（モデルは「それ」が人工知能を指すことを理解しています）。
8. **コードを表示** ボタンを使用して、インタラクションのコードを表示します。プロンプトには、*システム* メッセージ、*ユーザー* と *アシスタント* メッセージのFew-shotの例、およびこれまでのチャットセッションの *ユーザー* と *アシスタント* メッセージのシーケンスが含まれています。

## プロンプトとパラメータを探る

必要な応答を生成する可能性を最大化するために、プロンプトとパラメータを使用できます。

1. **パラメータ** ペインで、次のパラメータ値を設定します：
    - **温度**: 0
    - **最大長さ（トークン）**: 500

2. 次のメッセージを送信します

    ```
    次のテキストに基づいて3つの選択問題を作成し、正解を示してください。

    ほとんどのコンピュータビジョンソリューションは、カメラ、ビデオ、または画像からの視覚入力に適用できる機械学習モデルに基づいています。*

    - 画像分類には、画像の内容に基づいて画像を分類する機械学習モデルのトレーニングが含まれます。たとえば、交通監視ソリューションでは、タクシー、バス、サイクリストなど、含まれる車両の種類に基づいて画像を分類するために画像分類モデルを使用するかもしれません。*

    - 物体検出機械学習モデルは、画像内の個々の物体を分類し、境界ボックスでその位置を特定するためにトレーニングされます。たとえば、交通監視ソリューションでは、異なるクラスの車両の位置を特定するために物体検出を使用するかもしれません。*

    - セマンティックセグメンテーションは、画像内の個々のピクセルを、それらが属するオブジェクトに応じて分類する高度な機械学習技術です。たとえば、交通監視ソリューションでは、特定の色を使用して異なる車両を強調するために「マスク」レイヤーで交通画像をオーバーレイするかもしれません。
    ```

3. プロンプトで提示されたコンピュータビジョンのトピックに関する学生をテストするために教師が使用できる選択問題で構成されるべき結果を確認します。合計応答は、パラメータとして指定した最大長よりも小さいはずです。

    使用したプロンプトとパラメータについて次のことに注意してください：

    - プロンプトは、望ましい出力が3つの選択問題であることを明確に述べています。
    - パラメータには *温度* が含まれており、これは応答生成にランダム性の要素が含まれる程度を制御します。送信に使用された **0** の値はランダム性を最小限に抑え、安定した予測可能な応答をもたらします。
  
## コード生成の探索

自然言語の応答を生成するだけでなく、GPTモデルを使用してコードを生成することもできます。

1. **Assistant setup** ペインで、**Empty Example** テンプレートを選択してシステムメッセージをリセットします。
2. システムメッセージに `You are a Python developer.` と入力し、変更を保存します。
3. **Chat session** ペインで、**Clear chat** を選択してチャット履歴をクリアし、新しいセッションを開始します。
4. 次のユーザーメッセージを送信します：

    ```
    二つの数値パラメータを乗算する Multiply という名前の Python 関数を書いてください。
    ```

5. 応答を確認します。これには、プロンプトの要件を満たすサンプルの Python コードが含まれているはずです。

## クリーンアップ

Azure OpenAI リソースの使用が終わったら、**Azure portal** の `https://portal.azure.com` でデプロイメントを削除するか、リソース全体を削除することを忘れないでください。
